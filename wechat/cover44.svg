<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 450">
  <defs>
    <linearGradient id="bgGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#0a1628"/>
      <stop offset="100%" style="stop-color:#1a0a2a"/>
    </linearGradient>
    <filter id="glow">
      <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
  </defs>

  <!-- 背景 -->
  <rect width="800" height="450" fill="url(#bgGrad)"/>

  <!-- 主标题 -->
  <text x="400" y="45" fill="#ffffff" font-size="26" font-family="Arial, sans-serif" font-weight="bold" text-anchor="middle">
    Transformer 架构图解
  </text>
  <text x="400" y="72" fill="#aaaaaa" font-size="15" font-family="Arial, sans-serif" text-anchor="middle">
    小学生版：看懂这张图，你就入门了
  </text>

  <!-- 左边 Encoder -->
  <g transform="translate(120, 100)">
    <!-- 外框 -->
    <rect x="0" y="0" width="180" height="260" rx="10" fill="none" stroke="#f59e0b" stroke-width="3" filter="url(#glow)"/>
    <text x="90" y="-10" fill="#f59e0b" font-size="16" font-family="Arial" text-anchor="middle" font-weight="bold">Encoder</text>

    <!-- 内部模块 -->
    <!-- Norm -->
    <rect x="20" y="20" width="140" height="28" rx="4" fill="#22c55e" fill-opacity="0.3" stroke="#22c55e" stroke-width="1"/>
    <text x="90" y="39" fill="#22c55e" font-size="11" font-family="Arial" text-anchor="middle">Norm</text>

    <!-- Self-Attention (蓝色) -->
    <rect x="20" y="58" width="140" height="40" rx="4" fill="#3b82f6" fill-opacity="0.3" stroke="#3b82f6" stroke-width="1.5"/>
    <text x="90" y="83" fill="#3b82f6" font-size="11" font-family="Arial" text-anchor="middle">Self-Attention</text>

    <!-- 残差连接 -->
    <circle cx="170" cy="78" r="10" fill="none" stroke="#888" stroke-width="1"/>
    <text x="170" y="82" fill="#888" font-size="12" font-family="Arial" text-anchor="middle">+</text>

    <!-- Norm -->
    <rect x="20" y="108" width="140" height="28" rx="4" fill="#22c55e" fill-opacity="0.3" stroke="#22c55e" stroke-width="1"/>
    <text x="90" y="127" fill="#22c55e" font-size="11" font-family="Arial" text-anchor="middle">Norm</text>

    <!-- FFN (黄色) -->
    <rect x="20" y="146" width="140" height="40" rx="4" fill="#f59e0b" fill-opacity="0.3" stroke="#f59e0b" stroke-width="1.5"/>
    <text x="90" y="171" fill="#f59e0b" font-size="11" font-family="Arial" text-anchor="middle">Feed-Forward</text>

    <!-- 残差连接 -->
    <circle cx="170" cy="166" r="10" fill="none" stroke="#888" stroke-width="1"/>
    <text x="170" y="170" fill="#888" font-size="12" font-family="Arial" text-anchor="middle">+</text>

    <!-- Nx -->
    <text x="10" y="130" fill="#888" font-size="11" font-family="Arial" transform="rotate(-90, 10, 130)">Nx</text>

    <!-- 底部输入 -->
    <rect x="20" y="200" width="140" height="28" rx="4" fill="#666" fill-opacity="0.3" stroke="#666" stroke-width="1"/>
    <text x="90" y="219" fill="#aaa" font-size="10" font-family="Arial" text-anchor="middle">Embedding + PE</text>

    <!-- 输入箭头 -->
    <path d="M90,240 L90,260" stroke="#888" stroke-width="1.5" marker-end="url(#arrowGray)"/>
    <text x="90" y="280" fill="#888" font-size="10" font-family="Arial" text-anchor="middle">Source</text>
  </g>

  <!-- 右边 Decoder -->
  <g transform="translate(500, 100)">
    <!-- 外框 -->
    <rect x="0" y="0" width="180" height="260" rx="10" fill="none" stroke="#22c55e" stroke-width="3" filter="url(#glow)"/>
    <text x="90" y="-10" fill="#22c55e" font-size="16" font-family="Arial" text-anchor="middle" font-weight="bold">Decoder</text>

    <!-- 内部模块 -->
    <!-- Masked Self-Attention (红色) -->
    <rect x="20" y="20" width="140" height="35" rx="4" fill="#ef4444" fill-opacity="0.3" stroke="#ef4444" stroke-width="1.5"/>
    <text x="90" y="42" fill="#ef4444" font-size="10" font-family="Arial" text-anchor="middle">Masked Self-Attn</text>

    <!-- Cross-Attention (浅蓝) -->
    <rect x="20" y="65" width="140" height="35" rx="4" fill="#06b6d4" fill-opacity="0.3" stroke="#06b6d4" stroke-width="1.5"/>
    <text x="90" y="87" fill="#06b6d4" font-size="10" font-family="Arial" text-anchor="middle">Cross-Attention</text>

    <!-- FFN -->
    <rect x="20" y="110" width="140" height="35" rx="4" fill="#f59e0b" fill-opacity="0.3" stroke="#f59e0b" stroke-width="1.5"/>
    <text x="90" y="132" fill="#f59e0b" font-size="10" font-family="Arial" text-anchor="middle">Feed-Forward</text>

    <!-- Nx -->
    <text x="10" y="90" fill="#888" font-size="11" font-family="Arial" transform="rotate(-90, 10, 90)">Nx</text>

    <!-- Linear + Softmax -->
    <rect x="20" y="160" width="140" height="28" rx="4" fill="#8b5cf6" fill-opacity="0.3" stroke="#8b5cf6" stroke-width="1"/>
    <text x="90" y="179" fill="#8b5cf6" font-size="10" font-family="Arial" text-anchor="middle">Linear + Softmax</text>

    <!-- 底部输入 -->
    <rect x="20" y="200" width="140" height="28" rx="4" fill="#666" fill-opacity="0.3" stroke="#666" stroke-width="1"/>
    <text x="90" y="219" fill="#aaa" font-size="10" font-family="Arial" text-anchor="middle">Embedding + PE</text>

    <!-- 输入箭头 -->
    <path d="M90,240 L90,260" stroke="#888" stroke-width="1.5" marker-end="url(#arrowGray)"/>
    <text x="90" y="280" fill="#888" font-size="10" font-family="Arial" text-anchor="middle">Target</text>

    <!-- 输出箭头 -->
    <path d="M90,0 L90,-20" stroke="#8b5cf6" stroke-width="2"/>
    <text x="90" y="-30" fill="#8b5cf6" font-size="11" font-family="Arial" text-anchor="middle">Output</text>
  </g>

  <!-- Encoder → Decoder 连接线 (Cross-Attention) -->
  <path d="M300,200 Q400,200 500,182" fill="none" stroke="#06b6d4" stroke-width="2" stroke-dasharray="5,3" filter="url(#glow)"/>
  <text x="400" y="190" fill="#06b6d4" font-size="10" font-family="Arial" text-anchor="middle">K, V</text>

  <!-- 底部图例 -->
  <g transform="translate(150, 400)">
    <rect x="0" y="0" width="12" height="12" rx="2" fill="#3b82f6" fill-opacity="0.5"/>
    <text x="18" y="10" fill="#888" font-size="10" font-family="Arial">Self-Attn</text>

    <rect x="90" y="0" width="12" height="12" rx="2" fill="#ef4444" fill-opacity="0.5"/>
    <text x="108" y="10" fill="#888" font-size="10" font-family="Arial">Masked</text>

    <rect x="170" y="0" width="12" height="12" rx="2" fill="#06b6d4" fill-opacity="0.5"/>
    <text x="188" y="10" fill="#888" font-size="10" font-family="Arial">Cross-Attn</text>

    <rect x="270" y="0" width="12" height="12" rx="2" fill="#f59e0b" fill-opacity="0.5"/>
    <text x="288" y="10" fill="#888" font-size="10" font-family="Arial">FFN</text>

    <rect x="330" y="0" width="12" height="12" rx="2" fill="#22c55e" fill-opacity="0.5"/>
    <text x="348" y="10" fill="#888" font-size="10" font-family="Arial">Norm</text>

    <circle cx="416" cy="6" r="6" fill="none" stroke="#888" stroke-width="1"/>
    <text x="416" y="9" fill="#888" font-size="8" font-family="Arial" text-anchor="middle">+</text>
    <text x="430" y="10" fill="#888" font-size="10" font-family="Arial">残差</text>
  </g>

  <!-- 箭头标记 -->
  <defs>
    <marker id="arrowGray" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
      <path d="M0,0 L8,4 L0,8 Z" fill="#888"/>
    </marker>
  </defs>
</svg>
