<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 520">
  <defs>
    <linearGradient id="bgGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#0a1628"/>
      <stop offset="100%" style="stop-color:#1a0a2a"/>
    </linearGradient>
    <filter id="glow">
      <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
      <path d="M0,0 L10,5 L0,10 Z" fill="#888"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
      <path d="M0,0 L10,5 L0,10 Z" fill="#22c55e"/>
    </marker>
  </defs>

  <!-- 背景 -->
  <rect width="1000" height="520" fill="url(#bgGrad)"/>

  <!-- 标题 -->
  <text x="500" y="35" fill="#ffffff" font-size="22" font-family="Arial" font-weight="bold" text-anchor="middle">残差连接演化：原版 → HC → mHC</text>

  <!-- ========== 左边：原版残差连接 ========== -->
  <text x="140" y="70" fill="#f59e0b" font-size="14" font-family="Arial" font-weight="bold" text-anchor="middle">原版</text>

  <!-- 输入 -->
  <rect x="90" y="90" width="100" height="28" rx="5" fill="#3b82f6" fill-opacity="0.3" stroke="#3b82f6" stroke-width="2"/>
  <text x="140" y="108" fill="#3b82f6" font-size="11" font-family="Arial" text-anchor="middle">输入 h</text>

  <!-- 箭头向下 -->
  <line x1="140" y1="118" x2="140" y2="145" stroke="#888" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- 分叉点 -->
  <circle cx="140" cy="155" r="4" fill="#888"/>

  <!-- 左边直通（残差） -->
  <path d="M140,155 L80,155 L80,280 L115,280" stroke="#22c55e" stroke-width="2" fill="none"/>
  <text x="62" y="220" fill="#22c55e" font-size="9" font-family="Arial" text-anchor="middle" transform="rotate(-90, 62, 220)">直通</text>

  <!-- 右边过 Attention -->
  <line x1="140" y1="159" x2="140" y2="180" stroke="#888" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Attention 框 -->
  <rect x="95" y="185" width="90" height="35" rx="5" fill="#ef4444" fill-opacity="0.3" stroke="#ef4444" stroke-width="2"/>
  <text x="140" y="207" fill="#ef4444" font-size="10" font-family="Arial" text-anchor="middle">Attention</text>

  <!-- Attention 输出 -->
  <line x1="140" y1="220" x2="140" y2="250" stroke="#888" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- 加法节点 -->
  <circle cx="140" cy="280" r="16" fill="none" stroke="#f59e0b" stroke-width="2"/>
  <text x="140" y="285" fill="#f59e0b" font-size="14" font-family="Arial" text-anchor="middle">+</text>

  <!-- 绿色残差箭头连到加法 -->
  <line x1="115" y1="280" x2="124" y2="280" stroke="#22c55e" stroke-width="2" marker-end="url(#arrowGreen)"/>

  <!-- 输出 -->
  <line x1="140" y1="296" x2="140" y2="325" stroke="#888" stroke-width="2" marker-end="url(#arrow)"/>
  <rect x="90" y="330" width="100" height="28" rx="5" fill="#8b5cf6" fill-opacity="0.3" stroke="#8b5cf6" stroke-width="2"/>
  <text x="140" y="348" fill="#8b5cf6" font-size="11" font-family="Arial" text-anchor="middle">输出 h'</text>

  <!-- 公式 -->
  <text x="140" y="385" fill="#aaa" font-size="11" font-family="Arial" text-anchor="middle">h' = f(h) + h</text>
  <text x="140" y="405" fill="#666" font-size="10" font-family="Arial" text-anchor="middle">写死的 1:1</text>

  <!-- ========== 中间：HC ========== -->
  <text x="500" y="70" fill="#f59e0b" font-size="14" font-family="Arial" font-weight="bold" text-anchor="middle">HC（字节 2024）</text>

  <!-- 输入 -->
  <rect x="450" y="90" width="100" height="28" rx="5" fill="#3b82f6" fill-opacity="0.3" stroke="#3b82f6" stroke-width="2"/>
  <text x="500" y="108" fill="#3b82f6" font-size="11" font-family="Arial" text-anchor="middle">输入 h</text>

  <!-- 复制 -->
  <line x1="500" y1="118" x2="500" y2="138" stroke="#888" stroke-width="2"/>
  <text x="555" y="133" fill="#888" font-size="9" font-family="Arial">复制 n 份</text>

  <!-- 3 条流 -->
  <rect x="420" y="142" width="50" height="22" rx="3" fill="#22c55e" fill-opacity="0.3" stroke="#22c55e" stroke-width="1"/>
  <text x="445" y="157" fill="#22c55e" font-size="9" font-family="Arial" text-anchor="middle">流1</text>
  <rect x="475" y="142" width="50" height="22" rx="3" fill="#22c55e" fill-opacity="0.3" stroke="#22c55e" stroke-width="1"/>
  <text x="500" y="157" fill="#22c55e" font-size="9" font-family="Arial" text-anchor="middle">流2</text>
  <rect x="530" y="142" width="50" height="22" rx="3" fill="#22c55e" fill-opacity="0.3" stroke="#22c55e" stroke-width="1"/>
  <text x="555" y="157" fill="#22c55e" font-size="9" font-family="Arial" text-anchor="middle">流3</text>

  <!-- 连线到混合矩阵 -->
  <line x1="445" y1="164" x2="445" y2="182" stroke="#888" stroke-width="1"/>
  <line x1="500" y1="164" x2="500" y2="182" stroke="#888" stroke-width="1"/>
  <line x1="555" y1="164" x2="555" y2="182" stroke="#888" stroke-width="1"/>

  <!-- 混合矩阵 A -->
  <rect x="415" y="185" width="170" height="28" rx="4" fill="#f59e0b" fill-opacity="0.2" stroke="#f59e0b" stroke-width="2"/>
  <text x="500" y="203" fill="#f59e0b" font-size="10" font-family="Arial" text-anchor="middle">矩阵 A（可学习）</text>

  <!-- 到 Attention -->
  <line x1="500" y1="213" x2="500" y2="235" stroke="#888" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Attention -->
  <rect x="450" y="240" width="100" height="32" rx="5" fill="#ef4444" fill-opacity="0.3" stroke="#ef4444" stroke-width="2"/>
  <text x="500" y="260" fill="#ef4444" font-size="10" font-family="Arial" text-anchor="middle">Attention</text>

  <!-- 到分配矩阵 -->
  <line x1="500" y1="272" x2="500" y2="290" stroke="#888" stroke-width="2"/>

  <!-- 分配矩阵 B -->
  <rect x="415" y="293" width="170" height="28" rx="4" fill="#f59e0b" fill-opacity="0.2" stroke="#f59e0b" stroke-width="2"/>
  <text x="500" y="311" fill="#f59e0b" font-size="10" font-family="Arial" text-anchor="middle">矩阵 B（可学习）</text>

  <!-- 到输出流 -->
  <line x1="445" y1="321" x2="445" y2="338" stroke="#888" stroke-width="1"/>
  <line x1="500" y1="321" x2="500" y2="338" stroke="#888" stroke-width="1"/>
  <line x1="555" y1="321" x2="555" y2="338" stroke="#888" stroke-width="1"/>

  <!-- 3 条输出流 -->
  <rect x="420" y="342" width="50" height="22" rx="3" fill="#8b5cf6" fill-opacity="0.3" stroke="#8b5cf6" stroke-width="1"/>
  <text x="445" y="357" fill="#8b5cf6" font-size="9" font-family="Arial" text-anchor="middle">流1'</text>
  <rect x="475" y="342" width="50" height="22" rx="3" fill="#8b5cf6" fill-opacity="0.3" stroke="#8b5cf6" stroke-width="1"/>
  <text x="500" y="357" fill="#8b5cf6" font-size="9" font-family="Arial" text-anchor="middle">流2'</text>
  <rect x="530" y="342" width="50" height="22" rx="3" fill="#8b5cf6" fill-opacity="0.3" stroke="#8b5cf6" stroke-width="1"/>
  <text x="555" y="357" fill="#8b5cf6" font-size="9" font-family="Arial" text-anchor="middle">流3'</text>

  <!-- 说明 -->
  <text x="500" y="395" fill="#aaa" font-size="10" font-family="Arial" text-anchor="middle">A、B 任意学习</text>
  <text x="500" y="412" fill="#ef4444" font-size="10" font-family="Arial" text-anchor="middle">问题：大模型训练爆炸</text>
  <text x="500" y="429" fill="#666" font-size="9" font-family="Arial" text-anchor="middle">（27B 参数信号放大 3000×）</text>

  <!-- ========== 右边：mHC ========== -->
  <text x="850" y="70" fill="#f59e0b" font-size="14" font-family="Arial" font-weight="bold" text-anchor="middle">mHC（DeepSeek 2025）</text>

  <!-- 输入 -->
  <rect x="800" y="90" width="100" height="28" rx="5" fill="#3b82f6" fill-opacity="0.3" stroke="#3b82f6" stroke-width="2"/>
  <text x="850" y="108" fill="#3b82f6" font-size="11" font-family="Arial" text-anchor="middle">输入 h</text>

  <!-- 复制 -->
  <line x1="850" y1="118" x2="850" y2="138" stroke="#888" stroke-width="2"/>
  <text x="905" y="133" fill="#888" font-size="9" font-family="Arial">复制 n 份</text>

  <!-- 3 条流 -->
  <rect x="770" y="142" width="50" height="22" rx="3" fill="#22c55e" fill-opacity="0.3" stroke="#22c55e" stroke-width="1"/>
  <text x="795" y="157" fill="#22c55e" font-size="9" font-family="Arial" text-anchor="middle">流1</text>
  <rect x="825" y="142" width="50" height="22" rx="3" fill="#22c55e" fill-opacity="0.3" stroke="#22c55e" stroke-width="1"/>
  <text x="850" y="157" fill="#22c55e" font-size="9" font-family="Arial" text-anchor="middle">流2</text>
  <rect x="880" y="142" width="50" height="22" rx="3" fill="#22c55e" fill-opacity="0.3" stroke="#22c55e" stroke-width="1"/>
  <text x="905" y="157" fill="#22c55e" font-size="9" font-family="Arial" text-anchor="middle">流3</text>

  <!-- 连线到混合矩阵 -->
  <line x1="795" y1="164" x2="795" y2="182" stroke="#888" stroke-width="1"/>
  <line x1="850" y1="164" x2="850" y2="182" stroke="#888" stroke-width="1"/>
  <line x1="905" y1="164" x2="905" y2="182" stroke="#888" stroke-width="1"/>

  <!-- 混合矩阵 A（约束版） -->
  <rect x="765" y="185" width="170" height="28" rx="4" fill="#06b6d4" fill-opacity="0.3" stroke="#06b6d4" stroke-width="2"/>
  <text x="850" y="203" fill="#06b6d4" font-size="10" font-family="Arial" text-anchor="middle">矩阵 A（双随机约束）</text>

  <!-- 到 Attention -->
  <line x1="850" y1="213" x2="850" y2="235" stroke="#888" stroke-width="2" marker-end="url(#arrow)"/>

  <!-- Attention -->
  <rect x="800" y="240" width="100" height="32" rx="5" fill="#ef4444" fill-opacity="0.3" stroke="#ef4444" stroke-width="2"/>
  <text x="850" y="260" fill="#ef4444" font-size="10" font-family="Arial" text-anchor="middle">Attention</text>

  <!-- 到分配矩阵 -->
  <line x1="850" y1="272" x2="850" y2="290" stroke="#888" stroke-width="2"/>

  <!-- 分配矩阵 B（约束版） -->
  <rect x="765" y="293" width="170" height="28" rx="4" fill="#06b6d4" fill-opacity="0.3" stroke="#06b6d4" stroke-width="2"/>
  <text x="850" y="311" fill="#06b6d4" font-size="10" font-family="Arial" text-anchor="middle">矩阵 B（双随机约束）</text>

  <!-- 到输出流 -->
  <line x1="795" y1="321" x2="795" y2="338" stroke="#888" stroke-width="1"/>
  <line x1="850" y1="321" x2="850" y2="338" stroke="#888" stroke-width="1"/>
  <line x1="905" y1="321" x2="905" y2="338" stroke="#888" stroke-width="1"/>

  <!-- 3 条输出流 -->
  <rect x="770" y="342" width="50" height="22" rx="3" fill="#8b5cf6" fill-opacity="0.3" stroke="#8b5cf6" stroke-width="1"/>
  <text x="795" y="357" fill="#8b5cf6" font-size="9" font-family="Arial" text-anchor="middle">流1'</text>
  <rect x="825" y="342" width="50" height="22" rx="3" fill="#8b5cf6" fill-opacity="0.3" stroke="#8b5cf6" stroke-width="1"/>
  <text x="850" y="357" fill="#8b5cf6" font-size="9" font-family="Arial" text-anchor="middle">流2'</text>
  <rect x="880" y="342" width="50" height="22" rx="3" fill="#8b5cf6" fill-opacity="0.3" stroke="#8b5cf6" stroke-width="1"/>
  <text x="905" y="357" fill="#8b5cf6" font-size="9" font-family="Arial" text-anchor="middle">流3'</text>

  <!-- 说明 -->
  <text x="850" y="395" fill="#06b6d4" font-size="10" font-family="Arial" text-anchor="middle">约束：每行每列和 = 1</text>
  <text x="850" y="412" fill="#22c55e" font-size="10" font-family="Arial" text-anchor="middle">效果：信号放大 ≈ 1.6×</text>
  <text x="850" y="429" fill="#666" font-size="9" font-family="Arial" text-anchor="middle">（训练稳定，不爆炸）</text>

  <!-- 分隔线 -->
  <line x1="290" y1="80" x2="290" y2="440" stroke="#444" stroke-width="1" stroke-dasharray="5,5"/>
  <line x1="680" y1="80" x2="680" y2="440" stroke="#444" stroke-width="1" stroke-dasharray="5,5"/>

  <!-- 底部总结 -->
  <rect x="50" y="455" width="900" height="55" rx="8" fill="#1a1a3a" stroke="#444" stroke-width="1"/>
  <text x="500" y="478" fill="#ffffff" font-size="12" font-family="Arial" text-anchor="middle">
    核心区别：HC 的矩阵任意学习 → 信号爆炸；mHC 用 Sinkhorn-Knopp 算法投影到双随机矩阵 → 信息守恒
  </text>
  <text x="500" y="498" fill="#888" font-size="11" font-family="Arial" text-anchor="middle">
    双随机矩阵 = 每行和每列加起来都等于 1，相当于"信息只能重新分配，不能凭空放大"
  </text>
</svg>
